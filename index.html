<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ΩìÈáçË®òÈå≤„Ç¢„Éó„É™ v1.0.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine } = Recharts;

        const APP_VERSION = '1.0.2';

        const Icon = ({ d, className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={d} />
            </svg>
        );

        // BMI„ÅÆÂà§ÂÆö„Å®Ëâ≤„ÅÆÂèñÂæó
        const getBMICategory = (bmi) => {
            if (!bmi) return { label: '-', color: 'text-gray-500', bg: 'bg-gray-100' };
            const val = parseFloat(bmi);
            if (val < 18.5) return { label: '‰Ωé‰ΩìÈáç', color: 'text-blue-600', bg: 'bg-blue-100' };
            if (val < 25) return { label: 'ÊôÆÈÄö‰ΩìÈáç', color: 'text-green-600', bg: 'bg-green-100' };
            if (val < 30) return { label: 'ËÇ•Ê∫Ä(1Â∫¶)', color: 'text-orange-600', bg: 'bg-orange-100' };
            return { label: 'ËÇ•Ê∫Ä(2Â∫¶‰ª•‰∏ä)', color: 'text-red-600', bg: 'bg-red-100' };
        };

        function WeightTracker() {
            const [records, setRecords] = useState([]);
            const [weight, setWeight] = useState('');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [time, setTime] = useState(new Date().toTimeString().slice(0, 5));
            const [memo, setMemo] = useState('');
            const [goalWeight, setGoalWeight] = useState('');
            const [height, setHeight] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [period, setPeriod] = useState('all');
            const [deleteConfirm, setDeleteConfirm] = useState(null);
            const [showCalendar, setShowCalendar] = useState(false);
            const [showUpdateNotice, setShowUpdateNotice] = useState(false);

            // ÂàùÊúüË™≠„ÅøËæº„Åø
            useEffect(() => {
                const saved = localStorage.getItem('weightRecords');
                const savedGoal = localStorage.getItem('goalWeight');
                const savedHeight = localStorage.getItem('height');
                const savedVersion = localStorage.getItem('appVersion');

                if (saved) setRecords(JSON.parse(saved));
                if (savedGoal) setGoalWeight(savedGoal);
                if (savedHeight) setHeight(savedHeight);

                if (savedVersion !== APP_VERSION) {
                    setShowUpdateNotice(true);
                    localStorage.setItem('appVersion', APP_VERSION);
                    setTimeout(() => setShowUpdateNotice(false), 5000);
                }
            }, []);

            // ‰øùÂ≠ò„É≠„Ç∏„ÉÉ„ÇØÔºà‰øÆÊ≠£ÔºöÁ©∫„Å´„Å™„Å£„Å¶„ÇÇ‰øùÂ≠ò„Åô„ÇãÔºâ
            useEffect(() => {
                localStorage.setItem('weightRecords', JSON.stringify(records));
            }, [records]);

            const saveSettings = () => {
                localStorage.setItem('goalWeight', goalWeight);
                localStorage.setItem('height', height);
                setShowSettings(false);
            };

            const addRecord = () => {
                if (!weight || !date || !time) return;
                const newRecord = {
                    date,
                    time,
                    datetime: `${date} ${time}`,
                    weight: parseFloat(weight),
                    memo: memo || '',
                    id: Date.now()
                };
                const updated = [...records, newRecord].sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
                setRecords(updated);
                setWeight('');
                setMemo('');
            };

            const deleteRecord = (id) => setDeleteConfirm(records.find(r => r.id === id));
            
            const confirmDelete = () => {
                if (deleteConfirm) {
                    setRecords(records.filter(r => r.id !== deleteConfirm.id));
                    setDeleteConfirm(null);
                }
            };

            const exportData = () => {
                const csv = ['Êó•‰ªò,ÊôÇÂàª,‰ΩìÈáç(kg),BMI,„É°„É¢'];
                records.forEach(r => {
                    const bmi = (height && parseFloat(height) > 0) ? (r.weight / Math.pow(parseFloat(height) / 100, 2)).toFixed(1) : '';
                    csv.push(`${r.date},${r.time},${r.weight},${bmi},${r.memo}`);
                });
                const blob = new Blob([csv.join('\n')], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `‰ΩìÈáçË®òÈå≤_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            };

            const getFilteredRecords = () => {
                if (period === 'all') return records;
                const cutoff = new Date();
                if (period === 'week') cutoff.setDate(cutoff.getDate() - 7);
                else if (period === 'month') cutoff.setMonth(cutoff.getMonth() - 1);
                else if (period === 'three-months') cutoff.setMonth(cutoff.getMonth() - 3);
                return records.filter(r => new Date(r.datetime) >= cutoff);
            };

            const getConsecutiveDays = () => {
                if (records.length === 0) return 0;
                const today = new Date().toISOString().split('T')[0];
                const recordDates = new Set(records.map(r => r.date));
                let consecutive = 0;
                let checkDate = new Date();
                while (recordDates.has(checkDate.toISOString().split('T')[0])) {
                    consecutive++;
                    checkDate.setDate(checkDate.getDate() - 1);
                }
                return consecutive;
            };

            const filteredRecords = getFilteredRecords();
            const consecutiveDays = getConsecutiveDays();
            const lastRecord = records[records.length - 1];
            
            const currentBMI = (lastRecord && height && parseFloat(height) > 0) 
                ? (lastRecord.weight / Math.pow(parseFloat(height) / 100, 2)).toFixed(1) 
                : null;
            const bmiInfo = getBMICategory(currentBMI);

            const progress = (lastRecord && goalWeight && records[0].weight !== parseFloat(goalWeight))
                ? Math.min(100, Math.max(0, ((records[0].weight - lastRecord.weight) / (records[0].weight - parseFloat(goalWeight))) * 100))
                : null;

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 p-4 pb-20">
                    <div className="max-w-4xl mx-auto">
                        {/* „Ç¢„ÉÉ„Éó„Éá„Éº„ÉàÈÄöÁü• */}
                        {showUpdateNotice && (
                            <div className="fixed top-4 right-4 bg-indigo-600 text-white px-6 py-4 rounded-2xl shadow-2xl z-50 animate-bounce">
                                <div className="flex items-center gap-3">
                                    <span>‚ú® v{APP_VERSION} „Å´Êõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü</span>
                                </div>
                            </div>
                        )}

                        {/* ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ */}
                        {deleteConfirm && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl scale-in">
                                    <h3 className="text-xl font-bold mb-4 text-center">Ë®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü</h3>
                                    <div className="bg-gray-50 p-4 rounded-2xl mb-6 text-center">
                                        <div className="text-3xl font-bold text-indigo-600">{deleteConfirm.weight}kg</div>
                                        <div className="text-gray-500 text-sm mt-1">{deleteConfirm.date} {deleteConfirm.time}</div>
                                    </div>
                                    <div className="flex gap-3">
                                        <button onClick={() => setDeleteConfirm(null)} className="flex-1 py-3 bg-gray-100 rounded-xl font-bold">Êàª„Çã</button>
                                        <button onClick={confirmDelete} className="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold">ÂâäÈô§</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* „Éò„ÉÉ„ÉÄ„Éº */}
                        <div className="bg-white/80 backdrop-blur-md sticky top-0 z-30 rounded-2xl shadow-sm p-4 mb-6 flex justify-between items-center border border-white">
                            <div>
                                <h1 className="text-xl font-black text-slate-800">BODY LOG</h1>
                                <p className="text-[10px] text-slate-400 font-mono tracking-widest uppercase">Version {APP_VERSION}</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowSettings(!showSettings)} className="p-2 hover:bg-slate-100 rounded-full transition">
                                    <Icon d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                </button>
                                <button onClick={exportData} className="p-2 hover:bg-slate-100 rounded-full transition">
                                    <Icon d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </button>
                            </div>
                        </div>

                        {/* Ë®≠ÂÆö„Éë„Éç„É´ */}
                        {showSettings && (
                            <div className="bg-white rounded-3xl shadow-xl p-6 mb-6 animate-slide-down border-2 border-indigo-50">
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-xs font-bold text-slate-400 block mb-1 ml-1">Ë∫´Èï∑ (cm)</label>
                                        <input type="number" value={height} onChange={(e) => setHeight(e.target.value)} className="w-full p-3 bg-slate-50 rounded-2xl border-none focus:ring-2 ring-indigo-500 outline-none font-bold" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-400 block mb-1 ml-1">ÁõÆÊ®ô‰ΩìÈáç (kg)</label>
                                        <input type="number" value={goalWeight} onChange={(e) => setGoalWeight(e.target.value)} className="w-full p-3 bg-slate-50 rounded-2xl border-none focus:ring-2 ring-indigo-500 outline-none font-bold" />
                                    </div>
                                </div>
                                <button onClick={saveSettings} className="w-full mt-4 py-3 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg shadow-indigo-200">Ë®≠ÂÆö„Çí‰øùÂ≠ò</button>
                            </div>
                        )}

                        {/* ÂÖ•Âäõ„Ç®„É™„Ç¢ */}
                        <div className="bg-white rounded-3xl shadow-sm p-6 mb-6 border border-white">
                            <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
                                <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="p-3 bg-slate-50 rounded-xl text-sm font-bold border-none outline-none" />
                                <input type="time" value={time} onChange={(e) => setTime(e.target.value)} className="p-3 bg-slate-50 rounded-xl text-sm font-bold border-none outline-none" />
                                <div className="col-span-2 relative">
                                    <input type="number" step="0.1" value={weight} onChange={(e) => setWeight(e.target.value)} placeholder="‰ΩìÈáç„ÇíÂÖ•Âäõ" className="w-full p-3 bg-indigo-50 rounded-xl text-lg font-black border-none outline-none pr-10" />
                                    <span className="absolute right-3 top-4 text-xs font-bold text-indigo-400">kg</span>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <input type="text" value={memo} onChange={(e) => setMemo(e.target.value)} placeholder="„É°„É¢„ÇíÊÆã„ÅôÔºà‰ªªÊÑèÔºâ" className="flex-1 p-3 bg-slate-50 rounded-xl text-sm border-none outline-none" />
                                <button onClick={addRecord} className="px-8 py-3 bg-slate-800 text-white rounded-xl font-bold hover:scale-105 transition active:scale-95">Ë®òÈå≤„Åô„Çã</button>
                            </div>
                        </div>

                        {/* „Çπ„ÉÜ„Éº„Çø„Çπ */}
                        {lastRecord && (
                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                                <div className="bg-white p-5 rounded-3xl shadow-sm border border-white">
                                    <p className="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wider">Current Weight</p>
                                    <div className="flex items-baseline gap-1">
                                        <span className="text-3xl font-black text-slate-800">{lastRecord.weight}</span>
                                        <span className="text-xs font-bold text-slate-400">kg</span>
                                    </div>
                                </div>
                                <div className={`p-5 rounded-3xl shadow-sm border border-white ${bmiInfo.bg}`}>
                                    <p className={`text-[10px] font-bold mb-1 uppercase tracking-wider ${bmiInfo.color}`}>Current BMI</p>
                                    <div className="flex items-baseline gap-2">
                                        <span className={`text-3xl font-black ${bmiInfo.color}`}>{currentBMI || '-'}</span>
                                        <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full bg-white/50 ${bmiInfo.color}`}>{bmiInfo.label}</span>
                                    </div>
                                </div>
                                <div className="bg-white p-5 rounded-3xl shadow-sm border border-white col-span-2 sm:col-span-1">
                                    <p className="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wider">Streak</p>
                                    <div className="flex items-center gap-2">
                                        <span className="text-3xl font-black text-orange-500">{consecutiveDays}</span>
                                        <span className="text-xs font-bold text-slate-400 text-orange-400">Days! üî•</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* „Ç∞„É©„Éï */}
                        {records.length > 0 && (
                            <div className="bg-white rounded-3xl shadow-sm p-6 mb-6 border border-white">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="font-black text-slate-800 tracking-tight">PROGRESS CHART</h2>
                                    <div className="flex bg-slate-100 p-1 rounded-xl">
                                        {['week', 'month', 'all'].map(p => (
                                            <button key={p} onClick={() => setPeriod(p)} className={`px-4 py-1.5 rounded-lg text-[10px] font-bold transition ${period === p ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400'}`}>
                                                {p === 'week' ? '7D' : p === 'month' ? '1M' : 'ALL'}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="h-64 w-full">
                                    <ResponsiveContainer>
                                        <LineChart data={filteredRecords}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                            <XAxis dataKey="date" hide />
                                            <YAxis domain={['dataMin - 2', 'dataMax + 2']} hide />
                                            <Tooltip 
                                                contentStyle={{ borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }}
                                                labelStyle={{ fontWeight: 'bold', marginBottom: '4px' }}
                                            />
                                            {goalWeight && (
                                                <ReferenceLine y={parseFloat(goalWeight)} stroke="#cbd5e1" strokeDasharray="5 5" label={{ value: 'GOAL', position: 'right', fill: '#94a3b8', fontSize: 10, fontWeight: 'bold' }} />
                                            )}
                                            <Line type="monotone" dataKey="weight" stroke="#4f46e5" strokeWidth={4} dot={{ r: 4, fill: '#4f46e5', strokeWidth: 2, stroke: '#fff' }} activeDot={{ r: 6 }} />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        )}

                        {/* Ë®òÈå≤‰∏ÄË¶ß */}
                        <div className="space-y-3">
                            {[...records].reverse().map(r => {
                                const rowBmi = (height && parseFloat(height) > 0) ? (r.weight / Math.pow(parseFloat(height) / 100, 2)).toFixed(1) : null;
                                const rowBmiInfo = getBMICategory(rowBmi);
                                return (
                                    <div key={r.id} className="bg-white p-4 rounded-2xl flex items-center justify-between group border border-transparent hover:border-indigo-100 transition shadow-sm">
                                        <div className="flex items-center gap-4">
                                            <div className="text-center bg-slate-50 p-2 rounded-xl min-w-[60px]">
                                                <p className="text-[10px] font-bold text-slate-400 leading-none">{r.date.split('-')[1]}/{r.date.split('-')[2]}</p>
                                                <p className="text-[10px] text-slate-300">{r.time}</p>
                                            </div>
                                            <div>
                                                <div className="flex items-center gap-2">
                                                    <span className="text-xl font-black text-slate-800">{r.weight}kg</span>
                                                    {rowBmi && <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${rowBmiInfo.bg} ${rowBmiInfo.color}`}>BMI {rowBmi}</span>}
                                                </div>
                                                {r.memo && <p className="text-xs text-slate-500 mt-0.5">üí¨ {r.memo}</p>}
                                            </div>
                                        </div>
                                        <button onClick={() => deleteRecord(r.id)} className="p-2 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                                            <Icon d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </button>
                                    </div>
                                );
                            })}
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WeightTracker />);
    </script>
    <style>
        @keyframes slide-down { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-down { animation: slide-down 0.3s ease-out; }
        .scale-in { animation: scale-in 0.2s ease-out; }
        @keyframes scale-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</body>
</html>
